<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>카페듀몽블랑 룰렛 이벤트</title>
  <style>
    body {
      text-align: center; 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0;
    }
    h1 {
      margin-top: 30px;
    }

    #wheelContainer {
      position: relative;
      margin: 0 auto;
      width: 300px;
      height: 300px;
    }
    /* 룰렛 자체 */
    #wheel {
      width: 100%;
      height: 100%;
      border: 10px solid #333;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      transform-origin: center center;
      transform: rotate(0deg);
    }
    /* 룰렛 분할 영역(4등분) */
    .segment {
      position: absolute;
      width: 150px;   /* 지름의 절반 */
      height: 300px; 
      top: 0;
      left: 150px;    /* 룰렛 중앙 기준으로 시작 */
      transform-origin: left center;
    }
    /* 각 4칸(90도씩) */
    .seg1 {
      transform: rotate(0deg);
      background-color: #f99; /* 1등 영역 색상 */
    }
    .seg2 {
      transform: rotate(90deg);
      background-color: #9f9; /* 2등 영역 색상 */
    }
    .seg3 {
      transform: rotate(180deg);
      background-color: #99f; /* 3등 영역 색상 */
    }
    .seg4 {
      transform: rotate(270deg);
      background-color: #ff9; /* 4등 영역 색상 */
    }
    /* 각 세그먼트 내부 텍스트(등수) */
    .segment span {
      display: block;
      text-align: center;
      padding-top: 130px; /* 세그먼트 가운데쯤 */
      font-weight: bold;
      font-size: 18px;
      /* 글자 세우고 싶으면 회전 보정 */
      /* transform: rotate(-45deg); */
    }

    /* 포인터(삼각형) */
    #pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 20px solid #c00;
      z-index: 999;
    }

    #spinBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
    }
    #coupon {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>카페듀몽블랑 룰렛 이벤트</h1>
  <div id="wheelContainer">
    <!-- 포인터 -->
    <div id="pointer"></div>
    <!-- 룰렛 본체 -->
    <div id="wheel">
      <!-- 네 개 세그먼트 (1등 ~ 4등) -->
      <div class="segment seg1"><span>1등</span></div>
      <div class="segment seg2"><span>2등</span></div>
      <div class="segment seg3"><span>3등</span></div>
      <div class="segment seg4"><span>4등</span></div>
    </div>
  </div>

  <button id="spinBtn">룰렛 돌리기</button>
  <div id="result"></div>
  <div id="coupon"></div>

  <script>
    // 각 등수별 정보(이름, 확률, 쿠폰 파일)
    const prizes = [
      { name: "1등", probability: 1,  coupon: "coupon1.pdf" },
      { name: "2등", probability: 4,  coupon: "coupon2.pdf" },
      { name: "3등", probability: 15, coupon: "coupon3.pdf" },
      { name: "4등", probability: 80, coupon: "coupon4.pdf" }
    ];

    // 확률에 따라 당첨 결과 반환
    function getPrize() {
      let rand = Math.random() * 100; // 0~100
      let cumulative = 0;
      for (let prize of prizes) {
        cumulative += prize.probability;
        if (rand < cumulative) return prize;
      }
      // 혹시 분배가 100보다 작으면 마지막으로
      return prizes[prizes.length - 1];
    }

    const wheel     = document.getElementById("wheel");
    const resultDiv = document.getElementById("result");
    const couponDiv = document.getElementById("coupon");
    const spinBtn   = document.getElementById("spinBtn");

    // 회전 애니메이션 시간(ms)
    const SPIN_DURATION = 4000;

    spinBtn.addEventListener("click", function() {
      spinBtn.disabled = true;
      resultDiv.textContent = "";
      couponDiv.innerHTML = "";

      // 매번 룰렛 각도 초기화
      wheel.style.transition = "none";
      wheel.style.transform  = "rotate(0deg)";

      setTimeout(() => {
        wheel.style.transition = `transform ${SPIN_DURATION/1000}s ease-out`;

        // 당첨 결과 받기
        const prize = getPrize();

        // 룰렛 기본회전(4바퀴 이상) + 당첨칸 위치
        const baseRotation = 360 * 5; // 5바퀴
        const prizeIndex   = prizes.findIndex(p => p.name === prize.name);

        // 4분할이므로 각 칸은 90도씩
        const segmentAngle = 90;
        // 당첨칸 안에서 약간의 랜덤 오프셋
        const offset = Math.random() * segmentAngle;

        // 최종 회전각
        const targetAngle = baseRotation + (prizeIndex * segmentAngle) + offset;
        wheel.style.transform = `rotate(${targetAngle}deg)`;

        // 애니메이션 끝나면 결과 표시
        setTimeout(() => {
          resultDiv.textContent = `축하합니다! ${prize.name} 당첨!`;
          couponDiv.innerHTML = `<a href="${prize.coupon}" download>당첨 쿠폰 다운로드</a>`;
          spinBtn.disabled = false;
        }, SPIN_DURATION);
      }, 50);
    });
  </script>
</body>
</html>
